<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Automated Time Table Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f7f7f7;
    }
    h1, h2 { text-align: center; }
    form {
      background: white;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    label { display: block; margin-top: 10px; }
    input, select {
      margin-top: 5px;
      padding: 5px;
      width: 100%;
      max-width: 300px;
    }
    .teacher-profile {
      background: white;
      margin: 10px 0;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: white;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #4CAF50;
      color: white;
    }
    button {
      margin-top: 10px;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
    }
    button:hover { background: #45a049; }
  </style>
</head>
<body>

  <h1>Automated Time Table Generator</h1>

  <!-- Teacher form -->
  <form id="teacherForm">
    <h2>Add Teacher Assignment</h2>
    <label>Full Name: <input type="text" id="teacherName" required></label>

    <label>Subject:
      <select id="subject" required>
        <option value="">--Select Subject--</option>
        <option>Mathematics</option>
        <option>Physics</option>
        <option>Chemistry</option>
        <option>Computer Science</option>
        <option>English</option>
      </select>
    </label>

    <label>Class:
      <select id="class" required>
        <option value="">--Select Class--</option>
        <option>CSE</option>
        <option>ECE</option>
        <option>ME</option>
        <option>CE</option>
      </select>
    </label>

    <label>Date: <input type="date" id="date" required></label>

    <label>Available Time Slots:</label>
    <label><input type="checkbox" name="timeSlot" value="9-10"> 9-10</label>
    <label><input type="checkbox" name="timeSlot" value="10-11"> 10-11</label>
    <label><input type="checkbox" name="timeSlot" value="11-12"> 11-12</label>
    <label><input type="checkbox" name="timeSlot" value="1-2"> 1-2</label>
    <label><input type="checkbox" name="timeSlot" value="2-3"> 2-3</label>
    <label><input type="checkbox" name="timeSlot" value="3-4"> 3-4</label>

    <button type="submit">Add Assignment</button>
  </form>

  <h2>Teacher Profiles</h2>
  <div id="teacherProfiles"></div>

  <button id="generateBtn">Generate Timetable</button>

  <h2>Generated Timetable</h2>
  <div id="timetableOutput"></div>

  <script>
    const teachersData = {};  // stores teachers and their assignments
    let requests = [];        // flat list of assignment requests

    // Add teacher assignment
    document.getElementById('teacherForm').addEventListener('submit', e => {
      e.preventDefault();

      const name = document.getElementById('teacherName').value.trim();
      const subject = document.getElementById('subject').value;
      const cls = document.getElementById('class').value;
      const date = document.getElementById('date').value;
      const timeSlots = [...document.querySelectorAll('input[name="timeSlot"]:checked')].map(cb => cb.value);

      if (!name || !subject || !cls || !date || timeSlots.length === 0) {
        alert("Please fill all fields and select at least one timeslot.");
        return;
      }

      if (!teachersData[name]) {
        teachersData[name] = { assignments: [] };
      }

      const assignment = { teacher: name, subject, class: cls, date, availableTimeSlots: timeSlots };
      teachersData[name].assignments.push(assignment);
      requests.push(assignment);

      renderProfiles();
      e.target.reset();
    });

    // Render teacher profiles
    function renderProfiles() {
      const container = document.getElementById('teacherProfiles');
      container.innerHTML = "";
      for (const [name, data] of Object.entries(teachersData)) {
        const div = document.createElement('div');
        div.className = "teacher-profile";
        div.innerHTML = `<h3>${name}</h3>` +
          data.assignments.map(a =>
            `<p><b>Subject:</b> ${a.subject}, <b>Class:</b> ${a.class}, <b>Date:</b> ${a.date}, <b>Available:</b> ${a.availableTimeSlots.join(', ')}</p>`
          ).join('');
        container.appendChild(div);
      }
    }

    // CSP solver helpers
    function isValid(assignment, chosen, timetable) {
      const { teacher, class: cls, date } = assignment;
      const ts = chosen;

      for (const [t, slots] of Object.entries(timetable)) {
        for (const s of slots) {
          if (s.date === date && s.timeSlot === ts) {
            if (s.teacher === teacher) return false;  // teacher conflict
            if (s.class === cls) return false;        // class conflict
          }
        }
      }
      return true;
    }

    function selectUnassigned(requests, assigned, timetable) {
      let best = null;
      let minOptions = Infinity;

      for (const req of requests) {
        if (assigned.has(req)) continue;
        const options = req.availableTimeSlots.filter(ts => isValid(req, ts, timetable));
        if (options.length < minOptions) {
          minOptions = options.length;
          best = req;
        }
      }
      return best;
    }

    function backtrack(requests, timetable = {}, assigned = new Set()) {
      if (assigned.size === requests.length) return timetable;

      const req = selectUnassigned(requests, assigned, timetable);
      if (!req) return null;

      const options = req.availableTimeSlots.filter(ts => isValid(req, ts, timetable));

      for (const ts of options) {
        // assign
        timetable[req.teacher] = timetable[req.teacher] || [];
        timetable[req.teacher].push({ ...req, timeSlot: ts });

        assigned.add(req);

        const result = backtrack(requests, timetable, assigned);
        if (result) return result;

        // unassign
        timetable[req.teacher].pop();
        assigned.delete(req);
      }

      return null;
    }

    // Render timetable
    function renderTimetable(timetable) {
      let html = "<table><tr><th>Teacher</th><th>Subject</th><th>Class</th><th>Date</th><th>Time Slot</th></tr>";
      for (const [teacher, slots] of Object.entries(timetable)) {
        for (const s of slots) {
          html += `<tr>
            <td>${teacher}</td>
            <td>${s.subject}</td>
            <td>${s.class}</td>
            <td>${s.date}</td>
            <td>${s.timeSlot}</td>
          </tr>`;
        }
      }
      html += "</table>";
      document.getElementById('timetableOutput').innerHTML = html;
    }

    document.getElementById('generateBtn').addEventListener('click', () => {
      if (requests.length === 0) {
        alert("No assignments added yet.");
        return;
      }
      const timetable = backtrack(requests);
      if (timetable) {
        renderTimetable(timetable);
      } else {
        alert("No valid timetable could be generated.");
      }
    });
  </script>

</body>
</html>
